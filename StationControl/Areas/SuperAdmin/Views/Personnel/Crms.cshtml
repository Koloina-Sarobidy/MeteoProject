@model StationControl.Models.Personnel.ListeResponsablesCrmViewModel

@{
    Layout = "~/Areas/SuperAdmin/Views/Shared/_LayoutSuperAdmin.cshtml";
    ViewData["Title"] = "Responsables CRM";
}

<div class="container-fluid py-4">
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-primary">
                <i class="bi bi-people me-2"></i> Liste des Responsables CRM
            </h5>
            <button type="button" class="btn btn-outline-secondary me-2" onclick="history.back()">
                <i class="bi bi-arrow-left"></i> Retour
            </button>
        </div>

        <div class="card-body">
            <!-- Formulaire de filtre -->
            <form method="get" class="row g-3 mb-4 align-items-end">
                <div class="col-md-4">
                    <label class="form-label">CRM</label>
                    <select name="crmId" class="form-select">
                        <option value="">-- Tous les CRM --</option>
                        @foreach (var c in Model.Crms)
                        {
                            <option value="@c.Id" @(Model.CrmId == c.Id ? "selected" : "")>@c.Libelle</option>
                        }
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Date début</label>
                    <input type="date" name="dateDebut" value="@(Model.DateDebut?.ToString("yyyy-MM-dd"))" class="form-control" />
                </div>

                <div class="col-md-3">
                    <label class="form-label">Statut</label>
                    <select name="statut" class="form-select">
                        <option value="">-- Tous --</option>
                        <option value="Actif" @(Model.Statut == "Actif" ? "selected" : "")>Actif</option>
                        <option value="Congé" @(Model.Statut == "Congé" ? "selected" : "")>Congé</option>
                        <option value="Affecté" @(Model.Statut == "Affecté" ? "selected" : "")>Affecté</option>
                        <option value="Retraité" @(Model.Statut == "Retraité" ? "selected" : "")>Retraité</option>
                    </select>
                </div>

                <div class="col-md-4 d-flex gap-2">
                    <button class="btn btn-primary flex-grow-1"><i class="bi bi-funnel me-1"></i> Filtrer</button>
                    <a href="@Url.Action("ListeResponsablesCrm", "Personnel", new { area = "SuperAdmin" })" class="btn btn-outline-secondary flex-grow-1">
                        <i class="bi bi-arrow-counterclockwise me-1"></i> Réinitialiser
                    </a>
                </div>
            </form>

            </br></br>

            <!-- Table des responsables -->
            <div class="table-responsive" style="max-height:450px; overflow-y:auto; overflow-x:auto;">
                <table class="table table-striped table-hover table-bordered align-middle mb-0">
                    <thead class="table-light" style="position: sticky; top:0; z-index:5;">
                        <tr>
                            <th style="min-width:100px;">Profil</th>
                            <th style="min-width:180px;">Nom & Prénom(s)</th>
                            <th style="min-width:150px;">CRM</th>
                            <th style="min-width:120px;">Statut</th>
                            <th style="min-width:200px;">Email</th>
                            <th style="min-width:150px;">Date début</th>
                            <th style="min-width:150px;">Date fin</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Responsables != null && Model.Responsables.Any())
                        {
                            foreach (var u in Model.Responsables)
                            {
                                <tr style="cursor:pointer;" 
                                    onclick="window.location='@Url.Action("DetailsResponsableCrm", "Personnel", new { area = "SuperAdmin", id = u.Id })'">
                                    <td>
                                        @if (!string.IsNullOrEmpty(u.PhotoProfil))
                                        {
                                            <img src="~/uploads/profiles/@u.PhotoProfil"
                                                class="rounded-circle"
                                                style="width:45px; height:45px; object-fit:cover; border:1px solid #ddd;" />
                                        }
                                        else
                                        {
                                            <img src="https://ui-avatars.com/api/?name=@u.Nom+@u.Prenom&background=008B8B&color=fff&size=128"
                                                class="rounded-circle"
                                                style="width:45px; height:45px; border:1px solid #ddd;" />
                                        }
                                    </td>
                                    <td>@u.Nom @u.Prenom</td>
                                    <td>@Model.Crms.FirstOrDefault(x => x.Id == u.CrmId)?.Libelle</td>
                                    <td>
                                        @if (u.Statut == "Actif")
                                        {
                                            <span class="badge bg-success">Actif</span>
                                        }
                                        else if (u.Statut == "Congé")
                                        {
                                            <span class="badge bg-warning">Inactif</span>
                                        }
                                        else if (u.Statut == "Retraité" || u.Statut == "Affecté")
                                        {
                                            <span class="badge bg-secondary">@u.Statut</span>
                                        }
                                    </td>
                                    <td>@u.Email</td>
                                    <td>@u.DateDebut.ToString("dd/MM/yyyy")</td>
                                    <td>@(u.DateFin?.ToString("dd/MM/yyyy") ?? "-")</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6" class="text-center">Aucun responsable trouvé.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center mt-3">
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.Page ? "active" : "")">
                            <a class="page-link" href="@Url.Action("ListeResponsablesCrm", "Personnel", new { 
                                area = "SuperAdmin",
                                page = i,
                                crmId = Model.CrmId,
                                dateDebut = Model.DateDebut?.ToString("yyyy-MM-dd"),
                                statut = Model.Statut
                            })">
                                @i
                            </a>
                        </li>
                    }
                </ul>
            </nav>
        </div>
    </div>
</div>
