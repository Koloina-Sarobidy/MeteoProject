@{
Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
ViewData["Title"] = "Modifier statut";
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-1"></i>
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-1"></i>
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
    </div>
}

<div class="container py-4">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white">
            <h5 class="mb-0 text-primary">
                <i class="bi bi-person-gear me-2"></i>  Modifier le statut
            </h5>
        </div>


    <div class="card-body">
        <form id="statutForm" method="post" action="@Url.Action("ModifierStatut", "Utilisateur", new { area = "Admin" })"
>
            <div class="mb-3">
                <label class="form-label fw-bold">Statut actuel</label><br />
                @if (ViewBag.Utilisateur.Statut == "Actif")
                {
                    <span class="badge bg-success">@ViewBag.Utilisateur.Statut</span>
                }
                else if (ViewBag.Utilisateur.Statut == "Congé")
                {
                    <span class="badge bg-warning">@ViewBag.Utilisateur.Statut</span>
                }
                else
                {
                    <span class="badge bg-secondary">@ViewBag.Utilisateur.Statut</span>
                }
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Nouveau statut</label>
                <select class="form-select" name="statut" id="statutSelect" required>
                    <option value="">-- Sélectionner --</option>
                    <option value="Actif">Actif</option>
                    <option value="Congé">Congé</option>
                    <option value="Retraité">Retraité</option>
                    <option value="Affecté">Affecté</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Date de début</label>
                <input type="date" class="form-control" name="dateDebut" required />
            </div>
            
            <div class="mb-3 d-none" id="dateFinContainer">
                <label class="form-label fw-bold">Date de fin</label>
                <input type="date" class="form-control" name="dateFin" />
            </div>


            <div class="mb-3">
                <label class="form-label fw-bold">Description</label>
                <textarea name="description" class="form-control" rows="3"></textarea>
            </div>

            <div class="text-end">
                <button type="button" class="btn btn-outline-secondary me-2" onclick="history.back()">
                        <i class="bi bi-arrow-left"></i> Retour
                    </button>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#confirmModal">
                    <i class="bi bi-check-circle me-1"></i> Valider
                </button>
            </div>
        </form>

    </div>
</div>

</div>

<!-- Modal de confirmation -->

<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary"><i class="bi bi-exclamation-triangle"></i> Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

        <div class="modal-body">
            Voulez-vous vraiment modifier le statut ?
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="bi bi-x-circle"></i> Annuler
            </button>
            <button type="button" class="btn btn-primary" id="confirmSubmit">
                <i class="bi bi-check-circle"></i> Confirmer
            </button>
        </div>
    </div>
</div>

</div>

@section Scripts {

<script>
    document.getElementById("statutSelect").addEventListener("change", function () {
        const dateFin = document.getElementById("dateFinContainer");
        if (this.value === "Congé") {
            dateFin.classList.remove("d-none");
        } else {
            dateFin.classList.add("d-none");
        }
    });

    document.getElementById("confirmSubmit").addEventListener("click", function () {
        document.getElementById("statutForm").submit();
    });
</script>

}
